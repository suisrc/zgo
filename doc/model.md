# 数据库

```sql
PRIMARY KEY (`id`)
FOREIGN KEY fk_key(`xxx_id`)
REFERENCES xxx(`id`)
INDEX index_name (title(length))
UNIQUE index_name (title(length))
```
primary: 主键  
udx_xxx: 唯一索引  
idx_xxx: 索引  

fk_xxxx: 外键  
fk_account_user->user.id  
```sql model
ARG table_prefix=

includes=
excludes=
```

## 账户实体(`account`)

管理用户登陆控制,oauth2_token令牌为用户令牌, 与服务器令牌需要区别
同一个用户可以具有多个账户实体,每一种账户实体代表用户的一种登陆方式
用户每次绑定一个第三方账户,在实体中就会增加一条该用户的账户
当前用户如果绑定用户名,邮箱,手机登陆,意味着该用户具有3个本地实体
密码加密方式, password_type -> MD5和SHA1是一种依赖MD5和SHA1的自定义变种加密方式, BCR是标准的bcrypt加密,BCR2和BCR3是对盐值进行了加密
BCR2 -> 对salt进行了简单的倒序处理, BCR3 -> 对salt进行了以hashpassword为基础的位运算加密,不会影响其执行速度, 注意,其可以基于本身进行解密处理
经过测试, MD5和SHA1 -> 0.170s/万次, BCR -> 6.67s/百次, MD5和SHA1的执行效率大约是BCR的4000~5000倍, 在非必要请求下,请使用MD5或者SHA1

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | --------------------------------------------------- | ---------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL AUTO_INCREMENT, primary             |
| account       | 账户           | 字符串   | 账户和账户类型和账户归属平台构成唯一标识            | varchar(255), udx_account                            |
| account_type  | 账户类型       | 字符串   | 1:user 2:mobile 3:email 4:openid 5:unionid 6:token  | varchar(16) DEFAULT 'user', udx_account              |
| platform      | 账户归属平台   | 字符串   | 1:ZGO(当前平台) 2:OA2-[OAuth2.id](第三方平台)       | varchar(16) DEFAULT 'ZGO', udx_account               |
| verify_type   | 校验方式       | 字符串   | 1:PASSWD 2:SMS 3:OAUTH2                             | varchar(16) DEFAULT 'PASSWD'                         |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| password      | 登录密码       | 字符串   |                                                     | varchar(255)                                         |
| password_salt | 密码盐值       | 字符串   |                                                     | varchar(255)                                         |
| password_type | 校验方式       | 字符串   | 1:(明文) 2:MD5 3:SHA1 4: BCR 5: BCR2                | varchar(16)                                          |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| user_id       | 用户标识       | 数值     |                                                     | int(11), fk_account_user->user.id                    |
| role_id       | 角色标识       | 数值     | 如果不为空,表示账户和角色绑定                       | int(11), fk_account_role->role.id                    |
| status        | 状态           | 数值     | 1:启用 0:禁用                                       | tinyint(4) DEFAULT 1                                 |
| description   | 账户描述       | 字符串   |                                                     | varchar(255)                                         |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| oauth2_id     | oauth2认证     | 数值     |                                                     | int(11), fk_account_oauth2->oauth2_third.id          |
| oauth2_token  | oauth2令牌     | 字符串   | 服务器间通信令牌有二种, 用户 VS 服务器              | varchar(1024)                                        |
| oauth2_time   | oauth2创建时间 | 时间格式 | 令牌生成时间                                        | timestamp                                            |
| token_fake    | oauth2令牌     | 字符串   | 特殊的令牌,用于集群中应用间通信,可理解为永生令牌    | varchar(1024)                                        |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| creator       | 创建人         | 字符串   |                                                     | varchar(64)                                          |
| created_at    | 创建时间       | 时间格式 |                                                     | timestamp                                            |
| updated_at    | 更新时间       | 时间格式 |                                                     | timestamp                                            |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| string_1      | 备用字段       | 字符串   |                                                     | varchar(255)                                         |
| string_2      | 备用字段       | 字符串   |                                                     | varchar(255)                                         |
| string_3      | 备用字段       | 字符串   |                                                     | varchar(255)                                         |
| number_1      | 备用字段       | 数值     |                                                     | int(11)                                              |
| number_2      | 备用字段       | 数值     |                                                     | int(11)                                              |
| number_3      | 备用字段       | 数值     |                                                     | int(11)                                              |

---
## 第三方登陆实体(`oauth2_third`)

用于第三方授权登陆我们的系统

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL AUTO_INCREMENT, primary             |
| platform      | 平台           | 字符串   | 1:WX 2:TB 3:JD 4:GITEA 5:...                        | varchar(32) NOT NULL                                 |
| agent_id      | 代理商标识     | 字符串   |                                                     | varchar(255)                                         |
| suite_id      | 套件标识       | 字符串   |                                                     | varchar(255)                                         |
| app_id        | 应用标识       | 字符串   |                                                     | varchar(255)                                         |
| app_secret    | 应用密钥       | 字符串   |                                                     | varchar(1024)                                        |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| authorize_url | 认证地址       | 字符串   |                                                     | varchar(2048)                                        |
| token_url     | 令牌地址       | 字符串   |                                                     | varchar(2048)                                        |
| profile_url   | 个人资料地址   | 字符串   |                                                     | varchar(2048)                                        |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| domain_def    | 默认域名       | 字符串   | 必须以http或者https开头                             | varchar(128)                                         |
| domain_check  | 域名认证       | 字符串   | 格式:[file]:[context]                               | varchar(255)                                         |
| js_secret     | javascript密钥 | 字符串   | 需要js签名认证时候,进行认证的key                    | varchar(255)                                         |
| state_secret  | 回调state密钥  | 字符串   | 缓存处理state,用密钥计算state具有更好的分布式       | varchar(255)                                         |
| callback      | 是否支持回调   | 数值     |                                                     | tinyint(4) DEFAULT 0                                 |
| cb_encrypt    | 回调是否加密   | 数值     |                                                     | tinyint(4) DEFAULT 0                                 |
| cb_token      | 加密令牌       | 字符串   |                                                     | varchar(255)                                         |
| cb_encoding   | 加密编码       | 字符串   |                                                     | varchar(255)                                         |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| creator       | 创建人         | 字符串   |                                                     | varchar(64)                                          |
| created_at    | 创建时间       | 时间格式 |                                                     | timestamp                                            |
| updated_at    | 更新时间       | 时间格式 |                                                     | timestamp                                            |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| string_1      | 备用字段       | 字符串   |                                                     | varchar(255)                                         |
| string_2      | 备用字段       | 字符串   |                                                     | varchar(255)                                         |
| string_3      | 备用字段       | 字符串   |                                                     | varchar(255)                                         |
| number_1      | 备用字段       | 数值     |                                                     | int(11)                                              |
| number_2      | 备用字段       | 数值     |                                                     | int(11)                                              |
| number_3      | 备用字段       | 数值     |                                                     | int(11)                                              |

---
## 第三方登陆实体(`oauth2_token`)

与第三方系统通信时候,使用的令牌

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL AUTO_INCREMENT, primary             |
| oauth2_id     | 平台           | 字符串   |                                                     | int(11), fk_oa2_token_id->oauth2_third.id            |
| access_token  | 代理商标识     | 字符串   |                                                     | varchar(1024)                                        |
| expires_in    | 有限期间隔     | 字符串   |                                                     | int(11) DEFAULT 7200                                 |
| create_time   | 凭据创建时间   | 字符串   | 凭据是由远程服务器创建成功,和created_at不同         | timestamp                                            |
| sync_lock     | 同步锁         | 数值     | 同步锁,表示有人在更新令牌                           | tinyint(4) DEFAULT 0                                 |
| call_count    | 调用次数       | 数值     | 令牌被使用的次数                                    | int(11) DEFAULT 0                                    |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| creator       | 创建人         | 字符串   |                                                     | varchar(64)                                          |
| created_at    | 创建时间       | 时间格式 |                                                     | timestamp                                            |
| updated_at    | 更新时间       | 时间格式 |                                                     | timestamp                                            |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| string_1      | 备用字段       | 字符串   |                                                     | varchar(255)                                         |
| string_2      | 备用字段       | 字符串   |                                                     | varchar(255)                                         |
| string_3      | 备用字段       | 字符串   |                                                     | varchar(255)                                         |
| number_1      | 备用字段       | 数值     |                                                     | int(11)                                              |
| number_2      | 备用字段       | 数值     |                                                     | int(11)                                              |
| number_3      | 备用字段       | 数值     |                                                     | int(11)                                              |

---
## 第三方授权实体(`oauth2_client`)

我们的系统提供第三方登陆, 系统中不涉及第三方签发的令牌, 用户可以直接通过jwt访问我们系统
注意:如果用户签发的令牌具有audience权限,需要限定其使用, 可以在网关配置中增加jwt验证权限,拒绝该请求

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL AUTO_INCREMENT, primary             |
| client_key    | 客户端标识     | 字符串   | 未指定,会通过audience进行匹配                       | varchar(255)                                         |
| audience      | 账户接受平台   | 字符串   |                                                     | varchar(1024)                                        |
| issuer        | 账户签发平台   | 字符串   |                                                     | varchar(1024)                                        |
| expired       | 令牌有效期     | 数值     | 7200                                                | int(11)                                              |
| token_type    | 令牌类型       | 数值     | JWT                                                 | varchar(32)                                          |
| s_method      | 令牌方法       | 字符串   | HS512                                               | varchar(32)                                          |
| s_secret      | 令牌密钥       | 字符串   | signing secret                                      | varchar(1024)                                        |
| token_getter  | 令牌获取方法   | 字符串   | 1.header(Authorization) 2.query(token)              | varchar(32)                                          |
| -             |                |          | 3.cookie(authorization)                             |                                                      |
| signin_url    | 登陆地址       | 字符串   | 未指定redirect时候,默认的跳转地址                   | varchar(2048)                                        |
| signin_force  | 强制跳转登陆   | 数值     | false                                               | tinyint(4) DEFAULT 0                                 |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| creator       | 创建人         | 字符串   |                                                     | varchar(64)                                          |
| created_at    | 创建时间       | 时间格式 |                                                     | timestamp                                            |
| updated_at    | 更新时间       | 时间格式 |                                                     | timestamp                                            |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| string_1      | 备用字段       | 字符串   |                                                     | varchar(255)                                         |
| string_2      | 备用字段       | 字符串   |                                                     | varchar(255)                                         |
| string_3      | 备用字段       | 字符串   |                                                     | varchar(255)                                         |
| number_1      | 备用字段       | 数值     |                                                     | int(11)                                              |
| number_2      | 备用字段       | 数值     |                                                     | int(11)                                              |
| number_3      | 备用字段       | 数值     |                                                     | int(11)                                              |

---
## 第三方授权实体(`oauth2_account`)

第三方授权实体, 用于记录用户授权过的第三方登陆

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL AUTO_INCREMENT, primary             |
| account_id    | 账户标识       | 数值     |                                                     | int(11), fk_oa2_acc_id->account.id                   | 
| client_id     | 客户端标识     | 数值     |                                                     | int(11), fk_oa2_client_id->oauth2_client.id          |
| secret        | 密钥           | 字符串   |                                                     | varchar(1024)                                        |
| expired       | 授权有效期     | 时间格式 | 备用字段, 默认授权后永久有效                        | timestamp                                            |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| creator       | 创建人         | 字符串   |                                                     | varchar(64)                                          |
| created_at    | 创建时间       | 时间格式 |                                                     | timestamp                                            |
| updated_at    | 更新时间       | 时间格式 |                                                     | timestamp                                            |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| string_1      | 备用字段       | 字符串   |                                                     | varchar(255)                                         |
| string_2      | 备用字段       | 字符串   |                                                     | varchar(255)                                         |
| string_3      | 备用字段       | 字符串   |                                                     | varchar(255)                                         |
| number_1      | 备用字段       | 数值     |                                                     | int(11)                                              |
| number_2      | 备用字段       | 数值     |                                                     | int(11)                                              |
| number_3      | 备用字段       | 数值     |                                                     | int(11)                                              |

---
## 用户实体(`user`)

用户实体操作非常频繁,所以,其中的内容应该尽可能保存的少,更多详细信息可以通过detail进行保存
我们可以看到该实体没有共同字段,理由是共同字段可以通过detail得到,所以对于user实体无需共同字段
该内容未完,可进行扩展处理

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL AUTO_INCREMENT, primary             |
| uid           | 唯一标识       | 字符串   | 主要注意屏蔽系统中的id                              | varchar(64), udx_user_uid                            |
| name          | 用户名         | 字符串   |                                                     | varchar(64), udx_user_name                           |
| status        | 状态           | 数值     | 1:启用 0:禁用                                       | tinyint(4) DEFAULT 1                                 |

---
## 用户详情实体(`user_detail`)

用户详情
该内容未完,可进行扩展处理

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL, primary,fk_user_detail->user.id    |
| nickname      | 昵称           | 字符串   |                                                     | varchar(64)                                          |
| avatar        | 头像           | 字符串   |                                                     | varchar(512)                                         |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| creator       | 创建人         | 字符串   |                                                     | varchar(64)                                          |
| created_at    | 创建时间       | 时间格式 |                                                     | timestamp                                            |
| updated_at    | 更新时间       | 时间格式 |                                                     | timestamp                                            |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| string_1      | 备用字段       | 字符串   |                                                     | varchar(255)                                         |
| string_2      | 备用字段       | 字符串   |                                                     | varchar(255)                                         |
| string_3      | 备用字段       | 字符串   |                                                     | varchar(255)                                         |
| number_1      | 备用字段       | 数值     |                                                     | int(11)                                              |
| number_2      | 备用字段       | 数值     |                                                     | int(11)                                              |
| number_3      | 备用字段       | 数值     |                                                     | int(11)                                              |

---
## 用户消息实体(`user_message`)

主要用户系统通知

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL AUTO_INCREMENT, primary             |
| uid           | 索引           | 字符串   |                                                     | varchar(64), udx_user_message_uid                    |
| avatar        | 头像           | 字符串   |                                                     | varchar(512)                                         |
| title         | 标题           | 字符串   |                                                     | varchar(255)                                         |
| datetime      | 日期           | 字符串   |                                                     | timestamp                                            |
| type          | 类型           | 字符串   |                                                     | varchar(16)                                          |
| read          | 已读           | 数值     |                                                     | tinyint(4)                                           |
| description   | 描述           | 字符串   |                                                     | TEXT                                                 |
| clickClose    | 关闭           | 数值     |                                                     | tinyint(4)                                           |
| status        | 状态           | 数值     |                                                     | tinyint(4)                                           |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| creator       | 创建人         | 字符串   |                                                     | varchar(64)                                          |
| created_at    | 创建时间       | 时间格式 |                                                     | timestamp                                            |
| updated_at    | 更新时间       | 时间格式 |                                                     | timestamp                                            |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |

---
## 角色实体(`role`)

一个用户登陆系统后,只能有一个角色存在,如果有多角色的情况,需要进行选择

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL AUTO_INCREMENT, primary             |
| uid           | 唯一标识       | 字符串   | 主要注意屏蔽系统中的id                              | varchar(64), udx_role_uid                            |
| name          | 角色名         | 字符串   |                                                     | varchar(64), udx_role_name                           |
| description   | 角色描述       | 字符串   |                                                     | varchar(128)                                         |
| status        | 状态           | 数值     | 1:启用 0:禁用                                       | tinyint(4) DEFAULT 1                                 |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| creator       | 创建人         | 字符串   |                                                     | varchar(64)                                          |
| created_at    | 创建时间       | 时间格式 |                                                     | timestamp                                            |
| updated_at    | 更新时间       | 时间格式 |                                                     | timestamp                                            |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |

---
## 角色角色实体(`role_role`)

角色赋值时候,可能出现环,所以在保存角色时候,需要对角色进行校验,防止环形角色情况发生
角色中,会出现递归授权的问题,如何做到角色快速可达,是一个问题, 不过我们可以通过[Enforcer.GetImplicitRolesForUser]快速获取用户的角色列表

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL AUTO_INCREMENT, primary             |
| owner_id      | 父节点标识     | 数值     |                                                     | int(11), fk_role_owner_id->role.id                   |
| child_id      | 子节点标识     | 数值     |                                                     | int(11), fk_role_child_id->role.id                   |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| creator       | 创建人         | 字符串   |                                                     | varchar(64)                                          |
| created_at    | 创建时间       | 时间格式 |                                                     | timestamp                                            |
| updated_at    | 更新时间       | 时间格式 |                                                     | timestamp                                            |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |

---
## 用户角色实体(`user_role`)

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL AUTO_INCREMENT, primary             |
| user_id       | 账户标识       | 数值     |                                                     | int(11), fk_role_user_id->user.id                    |
| role_id       | 客户端标识     | 数值     |                                                     | int(11), fk_role_role_id->role.id                    |
| expired       | 授权有效期     | 时间格式 |                                                     | int(11)                                              |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| creator       | 创建人         | 字符串   |                                                     | varchar(64)                                          |
| created_at    | 创建时间       | 时间格式 |                                                     | timestamp                                            |
| updated_at    | 更新时间       | 时间格式 |                                                     | timestamp                                            |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |

---
## 资源实体(`resource`)

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL AUTO_INCREMENT, primary             |
| resource      | 资源名         | 字符串   | 资源名可以重复, 即该资源标识一类资源而不是单独      | varchar(64), idx_resource_name                       |
| domain        | 域名           | 字符串   | api.io                                              | varchar(255)                                         |
| methods       | 方法           | 字符串   | (GET)(POST)(PUT)(DELETE)                            | varchar(64)                                          |
| path          | 路径           | 字符串   | /api/*                                              | varchar(255)                                         |
| netmask       | 网络掩码       | 字符串   | 0.0.0.0/0                                           | varchar(64)                                          |
| allow         | 允许vs拒绝     | 数值     | 1: allow 0:deny                                     | tinyint(4)                                           |
| description   | 描述           | 字符串   |                                                     | varchar(128)                                         |
| status        | 状态           | 数值     | 1:启用 0:禁用                                       | tinyint(4) DEFAULT 1                                 |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| creator       | 创建人         | 字符串   |                                                     | varchar(64)                                          |
| created_at    | 创建时间       | 时间格式 |                                                     | timestamp                                            |
| updated_at    | 更新时间       | 时间格式 |                                                     | timestamp                                            |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |

---
## 资源角色实体(`resource_role`)

这里使用资源角色而非角色资源,是为了兼容casbin方式,我们对资源如下定义:
资源是一类请求资源的合集,而非一个.请求资源有唯一标识,但是资源没有,角色和资源绑定.

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL AUTO_INCREMENT, primary             |
| role_id       | 角色           | 数值     |                                                     | int(11), fk_resource_role_id->role.id                |
| resource      | 资源名         | 字符串   |                                                     | varchar(64), fk_resource_role_res->resource.resource |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| creator       | 创建人         | 字符串   |                                                     | varchar(64)                                          |
| created_at    | 创建时间       | 时间格式 |                                                     | timestamp                                            |
| updated_at    | 更新时间       | 时间格式 |                                                     | timestamp                                            |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |

## 资源角色实体(`resource_user`)

用于对某一个用户进行单独屏蔽操作, 非特殊情况下不推荐使用

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL AUTO_INCREMENT, primary             |
| user_id       | 用户           | 数值     |                                                     | int(11), fk_resource_user_id->user.id                |
| resource      | 资源名         | 字符串   |                                                     | varchar(64), fk_resource_user_res->resource.resource |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| creator       | 创建人         | 字符串   |                                                     | varchar(64)                                          |
| created_at    | 创建时间       | 时间格式 |                                                     | timestamp                                            |
| updated_at    | 更新时间       | 时间格式 |                                                     | timestamp                                            |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |
---
## 菜单实体(`menu`)

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL AUTO_INCREMENT, primary             |
| uid           | 唯一标识       | 字符串   |                                                     | varchar(32), udx_menu_uid                            |
| name          | 菜单名称       | 字符串   |                                                     | varchar(64)                                          |
| local         | 菜单名称       | 字符串   | 可以直接抽取前端i18n对应的内容                      | varchar(128)                                         |
| sequence      | 排序值         | 数值     |                                                     | tinyint(4) DEFAULT 64                                |
| group         | 菜单分组       | 字符串   |                                                     | varchar(64)                                          |
| group_local   | 菜单分组       | 字符串   |                                                     | varchar(64)                                          |
| icon          | 图标           | 字符串   |                                                     | varchar(255)                                         |
| router        | 访问路由       | 字符串   |                                                     | varchar(255)                                         |
| memo          | 备注           | 字符串   |                                                     | varchar(255)                                         |
| status        | 状态           | 数值     | 1:启用 0:禁用                                       | tinyint(4) DEFAULT 1                                 |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| creator       | 创建人         | 字符串   |                                                     | varchar(64)                                          |
| created_at    | 创建时间       | 时间格式 |                                                     | timestamp                                            |
| updated_at    | 更新时间       | 时间格式 |                                                     | timestamp                                            |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |

---
## 角色自定义菜单实体(`menu_role`)

角色具有包含角色的性质,所有在处理角色上,需要遍历角色,规则如下:  
1.使用角色获取菜单, 如果非空,直接结束,由于角色递归, 需要进行递归遍历  
2.如果都没有的情况下,使用role_id=nil获取菜单,不进行递归,该菜单列表认为是所有人可见的默认菜单  
这里会出现一个状况,一个角色继承了二个以上的角色,这时候,同一个菜单会被展示多次,暂时并未想好合适的解决方式

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL AUTO_INCREMENT, primary             |
| pid           | 父节点         | 数值     |                                                     | int(11), idx_parent_id                               |
| uid           | 唯一标识       | 字符串   |                                                     | varchar(32), udx_menu_role_uid                       |
| name          | 菜单名称       | 字符串   | 父节点不能为空,子节点为空,使用menu_id替换           | varchar(64)                                          |
| local         | 菜单名称       | 字符串   |                                                     | varchar(128)                                         |
| sequence      | 排序值         | 数值     |                                                     | tinyint(4) DEFAULT 64                                |
| role_id       | 角色 ID        | 数值     |                                                     | int(11), fk_menu_role_role_id->role.id               |
| role_uid      | 角色 UID       | 字符串   |                                                     | varchar(64), idx_role_uid                            |
| menu_id       | 菜单 ID        | 数值     |                                                     | int(11), fk_menu_role_menu_id->menu.id               |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| creator       | 创建人         | 字符串   |                                                     | varchar(64)                                          |
| created_at    | 创建时间       | 时间格式 |                                                     | timestamp                                            |
| updated_at    | 更新时间       | 时间格式 |                                                     | timestamp                                            |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |

---
## 角色自定义菜单实体(`menu_user`)

用户自定义菜单, 用户可以在自己可以查看的菜单中选择常用的菜单,进行展示

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL AUTO_INCREMENT, primary             |
| pid           | 父节点         | 数值     |                                                     | int(11), idx_parent_id                               |
| uid           | 唯一标识       | 字符串   |                                                     | varchar(64), udx_menu_role_uid                       |
| name          | 菜单名称       | 字符串   | 注意,这是用户自定义菜单,无需国际化处理              | varchar(64)                                          |
| sequence      | 排序值         | 数值     |                                                     | tinyint(4) DEFAULT 64                                |
| role_id       | 角色 ID        | 数值     |                                                     | int(11), fk_menu_user_role_id->role.id               |
| role_uid      | 角色 UID       | 字符串   |                                                     | varchar(64), idx_role_uid                            |
| menu_id       | 菜单 ID        | 数值     |                                                     | int(11), fk_menu_role_menu_id->menu.id               |
| user_id       | 用户 ID        | 数值     |                                                     | int(11), fk_menu_user_user_id->user.id               |
| menu_role_id  | 波及 ID        | 数值     | 当权限发生变更后，会收到影响或者波及的ID            | int(11), idx_menu_role_id                            |
| status        | 状态           | 数值     | 1:启用 0:禁用 非用户配置，权限变更波及              | tinyint(4) DEFAULT 1                                 |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| creator       | 创建人         | 字符串   |                                                     | varchar(64)                                          |
| created_at    | 创建时间       | 时间格式 |                                                     | timestamp                                            |
| updated_at    | 更新时间       | 时间格式 |                                                     | timestamp                                            |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |

---
## 菜单事件实体(`menu_action`)

主要用户系统中对操作的隐藏,如果需要禁用,需要配合resource使用,默认权限为启用
该内容一般用户初始化前端页面,用于对低权限的人屏蔽修改操作
由于casbin在系统中是由否定优先规则,即当系统中角色具有一票否决,通过role的向下遍历,确定角色上是否有操作的否决即可

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL AUTO_INCREMENT, primary             |
| menu_id       | 菜单 ID        | 数值     |                                                     | int(11), fk_menu_action_menu_id->menu.id             |
| role_id       | 角色 ID        | 数值     |                                                     | int(11), fk_menu_action_role_id->role.id             |
| role_uid      | 角色 UID       | 字符串   |                                                     | varchar(64), idx_role_uid                            |
| code          | 动作编号       | 字符串   |                                                     | varchar(64), idx_menu_action_code                    |
| name          | 动作名称       | 字符串   |                                                     | varchar(64), idx_menu_action_name                    |
| disable       | 状态           | 数值     | 0:启用 1:禁用                                       | tinyint(4) DEFAULT 0                                 |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| creator       | 创建人         | 字符串   |                                                     | varchar(64)                                          |
| created_at    | 创建时间       | 时间格式 |                                                     | timestamp                                            |
| updated_at    | 更新时间       | 时间格式 |                                                     | timestamp                                            |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |

---
## 通用标签实体(`tag_common`)

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL AUTO_INCREMENT, primary             |
| owner_id      | 归属id         | 数值     |                                                     | int(11), udx_tag_common_uid                          |
| type          | 标签类型       | 数值     | 1:用户 2:角色 3:资源                                | tinyint(4), udx_tag_common_uid                       |
| name          | 标签           | 字符串   |                                                     | varchar(64), idx_tag_common_name                     | 
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| creator       | 创建人         | 字符串   |                                                     | varchar(64)                                          |
| created_at    | 创建时间       | 时间格式 |                                                     | timestamp                                            |
| updated_at    | 更新时间       | 时间格式 |                                                     | timestamp                                            |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |

---
## 国际化实体(`i18n_language`)

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL AUTO_INCREMENT, primary             |
| mid           | message id     | 字符串   |                                                     | varchar(255), udx_i18n_message_id                    |
| lang          | 语言           | 字符串   | zh-CN, en-US                                        | varchar(16), udx_i18n_message_id                     |
| description   | 描述           | 字符串   |                                                     | varchar(64)                                          |
| left_delim    | 定界符         | 字符串   | 左边模板定界符                                      | varchar(16)                                          |
| right_delim   | 定界符         | 字符串   | 右边模板定界符                                      | varchar(16)                                          |
| zero          | zero           | 字符串   |                                                     | varchar(255)                                         |
| one           | one            | 字符串   |                                                     | varchar(255)                                         |
| two           | two            | 字符串   |                                                     | varchar(255)                                         |
| few           | few            | 字符串   |                                                     | varchar(255)                                         |
| many          | many           | 字符串   |                                                     | varchar(255)                                         |
| other         | other          | 字符串   | 默认                                                | varchar(255)                                         |
| status        | 状态           | 数值     | 1:启用 0:禁用                                       | tinyint(4) DEFAULT 1                                 |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| creator       | 创建人         | 字符串   |                                                     | varchar(64)                                          |
| created_at    | 创建时间       | 时间格式 |                                                     | timestamp                                            |
| updated_at    | 更新时间       | 时间格式 |                                                     | timestamp                                            |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |

---