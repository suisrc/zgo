
---
## 员工详情实体(`user_employee`)

员工详情
该内容未完,可进行扩展处理
内容暂时处于保留方式

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL, primary,fk_user_employee->user.id  |
| kid           | 唯一标识       | 字符串   |                                                     | varchar(64), udx_user_employee_kid                   |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| nickname      | 昵称           | 字符串   |                                                     | varchar(64)                                          |
| avatar        | 头像           | 字符串   |                                                     | varchar(255)                                         |
| mfa_secret    | MFA密钥        | 字符串   |                                                     | varchar(1024)                                        |
| deleted       | 逻辑删除       | 数值     | 用户不能删除,但是员工可以逻辑删除                   | tinyint(4) DEFAULT 0                                 |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| org_code      | 组织标识       | 字符串   | 冗余辅助字段，角色中包含org_code                    | varchar(64), fk_user_employee_roc->role.org_code     |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| creator       | 创建人         | 字符串   |                                                     | varchar(64)                                          |
| created_at    | 创建时间       | 时间格式 |                                                     | timestamp                                            |
| updated_at    | 更新时间       | 时间格式 |                                                     | timestamp                                            |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| string_1      | 备用字段       | 字符串   |                                                     | varchar(255)                                         |
| number_1      | 备用字段       | 数值     |                                                     | int(11)                                              |

---
## 顾客详情实体(`user_customer`)

顾客详情
该内容未完,可进行扩展处理
内容暂时处于保留方式

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL, primary,fk_user_customer->user.id  |
| kid           | 昵称           | 字符串   |                                                     | varchar(64), udx_user_customer                       |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| nickname      | 昵称           | 字符串   |                                                     | varchar(64)                                          |
| avatar        | 头像           | 字符串   |                                                     | varchar(255)                                         |
| mfa_secret    | MFA密钥        | 字符串   |                                                     | varchar(1024)                                        |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| org_code      | 组织标识       | 字符串   | 冗余辅助字段，角色中包含org_code                    | varchar(64), fk_user_customer_roc->role.org_code     |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| creator       | 创建人         | 字符串   |                                                     | varchar(64)                                          |
| created_at    | 创建时间       | 时间格式 |                                                     | timestamp                                            |
| updated_at    | 更新时间       | 时间格式 |                                                     | timestamp                                            |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| string_1      | 备用字段       | 字符串   |                                                     | varchar(255)                                         |
| number_1      | 备用字段       | 数值     |                                                     | int(11)                                              |

---
## 用户消息实体(`user_message`)

主要用户系统通知

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL AUTO_INCREMENT, primary             |
| fo_id         | 发送消息       | 字符串   |                                                     | int(64), fk_user_message_fo_id->user.id              |
| to_id         | 发送消息       | 字符串   |                                                     | int(64), fk_user_message_to_id->user.id              |
| kid           | 索引           | 字符串   |                                                     | varchar(64), udx_user_message_kid                    |
| type          | 类型           | 字符串   |                                                     | varchar(16)                                          |
| title         | 标题           | 字符串   |                                                     | varchar(255)                                         |
| avatar        | 头像           | 字符串   |                                                     | varchar(255)                                         |
| send_time     | 发送日期       | 字符串   |                                                     | timestamp                                            |
| read_time     | 读取日期       | 字符串   |                                                     | timestamp                                            |
| status        | 状态           | 数值     |                                                     | tinyint(4)                                           |
| deleted       | 逻辑删除       | 数值     | 消息只能逻辑删除, 一遍平台查询                      | tinyint(4) DEFAULT 0                                 |
| description   | 描述           | 字符串   | 消息描述可以是任意格式                              | TEXT                                                 |
| click_close   | 关闭           | 数值     |                                                     | tinyint(4)                                           |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| org_code      | 组织标识       | 字符串   | 冗余辅助字段，角色中包含org_code                    | varchar(64), fk_user_message_roc->role.org_code      |
| touch_mode    | 触达方式       | 字符串   |                                                     | varchar(255)                                         |
| delay_time    | 延迟触达       | 数值     |                                                     | timestamp                                            |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| string_1      | 备用字段       | 字符串   |                                                     | varchar(255)                                         |
| number_1      | 备用字段       | 数值     |                                                     | int(11)                                              |
| string_2      | 备用字段       | 字符串   |                                                     | varchar(255)                                         |
| number_2      | 备用字段       | 数值     |                                                     | int(11)                                              |
| string_3      | 备用字段       | 字符串   |                                                     | varchar(255)                                         |
| number_3      | 备用字段       | 数值     |                                                     | int(11)                                              |

---
## 菜单实体(`menu`)

菜单

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL AUTO_INCREMENT, primary             |
| kid           | 唯一标识       | 字符串   |                                                     | varchar(32), udx_menu_kid                            |
| name          | 菜单名称       | 字符串   |                                                     | varchar(64)                                          |
| local         | 菜单名称       | 字符串   | 可以直接抽取前端i18n对应的内容                      | varchar(128)                                         |
| sequence      | 排序值         | 数值     |                                                     | tinyint(4) DEFAULT 64                                |
| group         | 菜单分组       | 字符串   |                                                     | varchar(64)                                          |
| group_local   | 菜单分组       | 字符串   |                                                     | varchar(64)                                          |
| icon          | 图标           | 字符串   |                                                     | varchar(255)                                         |
| router        | 访问路由       | 字符串   |                                                     | varchar(255)                                         |
| memo          | 备注           | 字符串   |                                                     | varchar(255)                                         |
| domain        | 域名           | 字符串   |                                                     | varchar(255)                                         |
| status        | 状态           | 数值     | 1:启用 0:禁用                                       | tinyint(4) DEFAULT 1                                 |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| creator       | 创建人         | 字符串   |                                                     | varchar(64)                                          |
| created_at    | 创建时间       | 时间格式 |                                                     | timestamp                                            |
| updated_at    | 更新时间       | 时间格式 |                                                     | timestamp                                            |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| string_1      | 备用字段       | 字符串   |                                                     | varchar(255)                                         |
| number_1      | 备用字段       | 数值     |                                                     | int(11)                                              |

---
## 角色自定义菜单实体(`role_menu`)

角色具有包含角色的性质,所有在处理角色上,需要遍历角色,规则如下:  
1.使用角色获取菜单, 如果非空,直接结束,由于角色递归, 需要进行递归遍历  
2.如果都没有的情况下,使用role_id=nil获取菜单,不进行递归,该菜单列表认为是所有人可见的默认菜单  
这里会出现一个状况,一个角色继承了二个以上的角色,这时候,同一个菜单会被展示多次,暂时并未想好合适的解决方式

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL AUTO_INCREMENT, primary             |
| pid           | 父节点         | 数值     |                                                     | int(11), idx_parent_id                               |
| kid           | 唯一标识       | 字符串   |                                                     | varchar(32), udx_menu_role_kid                       |
| name          | 菜单名称       | 字符串   | 父节点不能为空,子节点为空,使用menu_id替换           | varchar(64)                                          |
| local         | 菜单名称       | 字符串   |                                                     | varchar(128)                                         |
| sequence      | 排序值         | 数值     |                                                     | tinyint(4) DEFAULT 64                                |
| role_id       | 角色 ID        | 数值     |                                                     | int(11), fk_menu_role_role_id->role.id               |
| role_kid      | 角色 UID       | 字符串   | 与role_id效果相同                                   | varchar(64), idx_role_kid                            |
| menu_id       | 菜单 ID        | 数值     |                                                     | int(11), fk_menu_role_menu_id->menu.id               |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| creator       | 创建人         | 字符串   |                                                     | varchar(64)                                          |
| created_at    | 创建时间       | 时间格式 |                                                     | timestamp                                            |
| updated_at    | 更新时间       | 时间格式 |                                                     | timestamp                                            |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |

---
## 角色自定义菜单实体(`user_menu`)

用户自定义菜单, 用户可以在自己可以查看的菜单中选择常用的菜单,进行展示,
展示的内容

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL AUTO_INCREMENT, primary             |
| role_id       | 角色 ID        | 数值     |                                                     | int(11), fk_menu_user_role_id->user_role.id          |
| menu_id       | 菜单 ID        | 字符串   | menu kid list                                       | varchar(4096)                                        |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| creator       | 创建人         | 字符串   |                                                     | varchar(64)                                          |
| created_at    | 创建时间       | 时间格式 |                                                     | timestamp                                            |
| updated_at    | 更新时间       | 时间格式 |                                                     | timestamp                                            |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |

---
## 菜单事件实体(`menu_action`)

主要用户系统中对操作的隐藏,如果需要禁用,需要配合gateway使用,默认权限为启用
该内容一般用户初始化前端页面,用于对低权限的人屏蔽修改操作
由于casbin在系统中是由否定优先规则,即当系统中角色具有一票否决,通过role的向下遍历,确定角色上是否有操作的否决即可

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL AUTO_INCREMENT, primary             |
| menu_id       | 菜单 ID        | 数值     |                                                     | int(11), fk_menu_action_menu_id->menu.id             |
| role_id       | 角色 ID        | 数值     |                                                     | int(11), fk_menu_action_role_id->role.id             |
| code          | 动作编号       | 字符串   |                                                     | varchar(64), idx_menu_action_code                    |
| name          | 动作名称       | 字符串   |                                                     | varchar(64), idx_menu_action_name                    |
| disable       | 状态           | 数值     | 0:启用 1:禁用                                       | tinyint(4) DEFAULT 0                                 |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| creator       | 创建人         | 字符串   |                                                     | varchar(64)                                          |
| created_at    | 创建时间       | 时间格式 |                                                     | timestamp                                            |
| updated_at    | 更新时间       | 时间格式 |                                                     | timestamp                                            |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |



---
## 服务实体(`client`)


| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL AUTO_INCREMENT, primary             |
| kid           | 客户端标识     | 字符串   | jwt的header[kid], 请求未指定看audience              | varchar(64)  NOT NULL, udx_client_kid         |
| secret        | 客户端密钥     | 字符串   | 主要用于应用间通信                                  | varchar(1024)                                        |
| org_id        | 租户标识       | 数值     | 如果不为空,表示账户和租户绑定                       | int(11), fk_client_org_id->tenant.id           |
| audience      | 接受域         | 字符串   | 用于跳转或者登录授权                                | varchar(255)                                         |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| jwt_audience  | 令牌接受平台   | 字符串   |                                                     | varchar(255)                                         |
| jwt_issuer    | 令牌签发平台   | 字符串   |                                                     | varchar(255)                                         |
| jwt_expired   | 令牌有效期     | 数值     | 7200                                                | int(11) DEFAULT 7200                                 |
| jwt_type      | 令牌类型       | 数值     | JWT 不可修改                                        | varchar(32) DEFAULT 'JWT'                            |
| jwt_method    | 令牌方法       | 字符串   | HS512 不可修改                                      | varchar(32) DEFAULT 'HS512'                          |
| jwt_secret    | 令牌密钥       | 字符串   | signing secret                                      | varchar(255) NOT NULL                                |
| jwt_getter    | 令牌获取方法   | 字符串   | 1.header(authorization) 2.query(token)              | varchar(32)                                          |
| -             |                |          | 3.cookie(authorization) (备用字段)                  |                                                      |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| signin_url    | 登陆地址       | 字符串   | 未指定redirect时候,默认的跳转地址， 默认为audience  | varchar(2048)                                        |
| signin_check  | 登陆确认       | 数值     | false, 登陆是否需要确认                             | tinyint(4) DEFAULT 0                                 |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| status        | 状态           | 数值     | 1:启用 0:禁用                                       | tinyint(4) DEFAULT 1                                 |
| delete        | 删除标识       | 数值     | 1:删除 0:正常                                       | tinyint(4) DEFAULT 0                                 |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| creator       | 创建人         | 字符串   |                                                     | varchar(64)                                          |
| created_at    | 创建时间       | 时间格式 |                                                     | timestamp                                            |
| updated_at    | 更新时间       | 时间格式 |                                                     | timestamp                                            |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| string_1      | 备用字段       | 字符串   |                                                     | varchar(255)                                         |
| number_1      | 备用字段       | 数值     |                                                     | int(11)                                              |


---
## 子应用用户(`user_client_id`)

用户对应子系统内容

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| user_id       | 用户ID         | 数值     |                                                     | int(11) NOT NULL, fk_user_client_uid->user.id        |
| client_id     | 客户端ID       | 数值     |                                                     | int(11) NOT NULL, udx_user_client_id_akid,fk_user_client_id_client_id->client.id |
| akid          | 应用唯一标识   | 字符串   |                                                     | int(11) NOT NULL, udx_user_client_id_akid            |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| status        | 状态           | 数值     | 1:启用 0:禁用 2: 未激活 3: 销户                     | tinyint(4) DEFAULT 1                                 |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| string_1      | 备用字段       | 字符串   |                                                     | varchar(255)                                         |
| number_1      | 备用字段       | 数值     |                                                     | int(11)                                              |


第三方授权实体, 用户完成授权后,需要处理令牌,选择授权系统
已知: 
A用户:  [host]              请求域
        [client]            应用ID
B角色:  [Role.audience]       角色域
C应用:  [Client.kid]        应用ID
        [Client.audience]   接受域
约束:
0.[Client]为空, 通过[host]确认[Client], 如果存在多个,随机选择
1.[Client]为空, [Role.audience]必须为空或者等于[host]
2.[Client.audience]不为空, 必须等于[host]
3.[Role.audience]为空, 直接返回true, 该角色为全平台角色 
4.[Client.audience]不为空, 必须等于[Role.audience]需要匹配
5.验证[Role.audience]和[host]

角色约束:
1.如果当前账户的角色可以授权,直接授权
2.如果该用户具有单角色,登陆的子系统没有角色,则放弃授权
3.如果具有多角色,优先使用上次登陆的角色登陆系统, 如果上次的角色被剥夺或者第一次登陆的情况使用第四条规则
4.选择第一角色直接授权,并提供角色选择接口

---
## 资源实体(`gateway`)

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL AUTO_INCREMENT, primary             |
| kid           | 唯一标识       | 字符串   | casbin系统使用， 全平台字段                         | varchar(64), udx_gateway_kid                         |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| name          | 角色名         | 字符串   | casbin系统使用， 租户内部字段                       | varchar(64), udx_gateway_name                        |
| org_id        | 租户标识       | 字符串   | 角色归属的租户， 1表示平台                          | int(11), udx_gateway_name, fk_gateway_org_id->tenant.id |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| methods       | 方法           | 字符串   | (GET)(POST)(PUT)(DELETE)                            | varchar(64)                                          |
| domains       | 接受域         | 字符串   | api.io, 不同于role中的audience，它只是跨区域表现    | varchar(255)                                         |
| paths         | 路径           | 字符串   | /api/*                                              | varchar(255)                                         |
| netmasks      | 网络掩码       | 字符串   | 0.0.0.0/0                                           | varchar(255)                                         |
| effect         | 允许vs拒绝     | 数值     | 1: allow 0:deny                                     | tinyint(4)                                           |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| status        | 状态           | 数值     | 1:启用 0:禁用 2:未激活                              | tinyint(4) DEFAULT 1                                 |
| description   | 描述           | 字符串   |                                                     | varchar(255)                                         |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| creator       | 创建人         | 字符串   |                                                     | varchar(64)                                          |
| created_at    | 创建时间       | 时间格式 |                                                     | timestamp                                            |
| updated_at    | 更新时间       | 时间格式 |                                                     | timestamp                                            |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| string_1      | 备用字段       | 字符串   |                                                     | varchar(255)                                         |
| number_1      | 备用字段       | 数值     |                                                     | int(11)                                              |

---
## 资源角色实体(`role_gateway`)

这里使用资源角色而非角色资源,是为了兼容casbin方式,我们对资源如下定义:
资源是一类请求资源的合集,而非一个.请求资源有唯一标识,但是资源没有,角色和资源绑定.

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL AUTO_INCREMENT, primary             |
| rid           | 角色           | 数值     |                                                     | int(11), fk_role_gateway_rid->role.id                |
| gid           | 资源           | 数值     |                                                     | int(11), fk_role_gateway_gid->gateway.id             |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| org_code      | 租户标识       | 字符串   | 冗余辅助字段，角色中包含org_code                    | varchar(64), fk_role_gateway_roc->role.org_code      |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| creator       | 创建人         | 字符串   |                                                     | varchar(64)                                          |
| created_at    | 创建时间       | 时间格式 |                                                     | timestamp                                            |
| updated_at    | 更新时间       | 时间格式 |                                                     | timestamp                                            |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |

---
## 资源角色实体(`user_gateway`)

用于对某一个用户进行单独屏蔽操作, 非特殊情况下不推荐使用

| 字段          | 中文说明       | 字段类型 | 备注                                                | MYSQL                                                |
| ------------- | -------------- | -------- | ---------------------------------------------------------------------------------------------------------- |
| id            | 唯一标识       | 数值     |                                                     | int(11) NOT NULL AUTO_INCREMENT, primary             |
| uid           | 用户           | 数值     |                                                     | int(11), fk_user_gateway_uid->user.id                |
| gid           | 资源           | 数值     |                                                     | int(11), fk_user_gateway_gid->gateway.id             |
| expired       | 授权有效期     | 时间格式 |                                                     | int(11)                                              |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| org_code      | 租户标识       | 字符串   | 冗余辅助字段，角色中包含org_code                    | varchar(64), fk_user_gateway_roc->role.org_code      |
| ------------------------------------------------------------------------------------------------------------------------------------------------------ |
| creator       | 创建人         | 字符串   |                                                     | varchar(64)                                          |
| created_at    | 创建时间       | 时间格式 |                                                     | timestamp                                            |
| updated_at    | 更新时间       | 时间格式 |                                                     | timestamp                                            |
| version       | 数据版本       | 数值     |                                                     | int(11) DEFAULT 0                                    |
